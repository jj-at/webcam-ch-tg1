<!DOCTYPE html>
<html>
<head>
    <title>Webcam Clima - En Vivo</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { 
            font-family: Arial, sans-serif; 
            text-align: center; 
            padding: 20px; 
            background: #f0f8ff; 
        }
        img { 
            max-width: 100%; 
            height: auto; 
            border: 3px solid #333; 
            border-radius: 8px; 
            margin: 20px 0; 
        }
        .info { 
            background: #e0f7fa; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 20px auto; 
            max-width: 600px; 
        }
        .error { color: #e74c3c; }
    </style>
</head>
<body>
    <h1>üå§Ô∏è Webcam Clima en Vivo</h1>
    <div class="info">
        <p>
            <strong>Temperatura:</strong> <span id="temp">--</span>¬∞C | 
            <strong>Humedad:</strong> <span id="hum">--</span>% | 
            <strong>Presi√≥n:</strong> <span id="pres">--</span> Pa<br>
            <strong>√öltima actualizaci√≥n:</strong> <span id="last-update">--:--</span>
        </p>
    </div>
    
    <img src="foto_original_datos.jpg" id="webcam-img" alt="Webcam en vivo">
    
    <p><em>Actualizando aproximadamente cada minuto...</em></p>
    <p>
        <!-- dfdg -->
        <a href="https://www.youtube.com/channel/UCDRn0hhsZLYW2vXFKQcPZVg/live" target="_blank" rel="noopener">
        <!-- <a href="https://www.youtube.com/embed/live_stream?channel=UCDRn0hhsZLYW2vXFKQcPZVg&autoplay=1&mute=1" target="_blank" rel="noopener"> -->
            Ver transmisi√≥n en vivo en YouTube
        </a>
    </p>
    <hr>
    <p>¬øTe sirve esta webcam? <a href="https://paypal.me/tuusuario">¬°Ap√≥yame con una donaci√≥n!</a> üôè</p>

    <script>
        // Funci√≥n para parsear la marca de tiempo (YYYYMMDDHHMMSS)
        function parsearTimestamp(ts) {
            const a√±o = parseInt(ts.substring(0, 4));
            const mes = parseInt(ts.substring(4, 6)) - 1; // Meses en JS son 0-11
            const dia = parseInt(ts.substring(6, 8));
            const hora = parseInt(ts.substring(8, 10));
            const min = parseInt(ts.substring(10, 12));
            const seg = parseInt(ts.substring(12, 14));
            return new Date(a√±o, mes, dia, hora, min, seg);
        }
    
        // Nueva funci√≥n: cargar solo el √∫ltimo dato
        async function cargarUltimoDato() {
            const url = `ultimo_dato.txt?t=${Date.now()}`;
    
            try {
                const respuesta = await fetch(url);
                if (!respuesta.ok) throw new Error(`No se pudo cargar ${url}`);
                
                const linea = (await respuesta.text()).trim();
                if (!linea) throw new Error("Archivo vac√≠o");
                
                const columnas = linea.split(',');
                if (columnas.length < 5) throw new Error("Formato inv√°lido");
    
                const timestamp = columnas[0];
                const temp1 = parseFloat(columnas[1]);
                const temp2 = parseFloat(columnas[2]);
                const humedad = parseFloat(columnas[3]);
                const presion = parseFloat(columnas[4]);
    
                // Promedio de temperaturas
                const tempProm = ((temp1 + temp2) / 2).toFixed(1);
    
                document.getElementById('temp').textContent = tempProm;
                document.getElementById('hum').textContent = humedad;
                document.getElementById('pres').textContent = presion.toFixed(1);
                document.getElementById('last-update').textContent = 
                    parsearTimestamp(timestamp).toLocaleTimeString();
    
                document.querySelector('.info').classList.remove('error');
            } catch (error) {
                console.error("Error al cargar ultimo_dato.txt:", error);
                document.getElementById('temp').textContent = "--";
                document.getElementById('hum').textContent = "--";
                document.getElementById('pres').textContent = "--";
                document.getElementById('last-update').textContent = "Error al cargar datos";
                document.querySelector('.info').classList.add('error');
            }
        }
    
        function actualizarTodo() {
            const ahora = new Date();
            const img = document.getElementById('webcam-img');
            img.src = "foto_original_datos.jpg?t=" + ahora.getTime();
            cargarUltimoDato();
        }
    
        window.onload = function() {
            actualizarTodo();
            setInterval(actualizarTodo, 60000);
        };
    </script>
</body>
</html>
